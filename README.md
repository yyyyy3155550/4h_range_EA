# 4h_range_ea

## 概要

このEAは、4時間足レンジブレイクに着目した逆張り手法の自動売買エキスパートアドバイザー（EA）です。  
4Hレンジの高値・安値レンジを抜けたタイミングで、逆張りエントリーを行うロジックとなっています。

---

## 主な機能

- 4時間足の高値・安値レンジ検出
- レンジブレイク後の逆張りエントリー
- 利確・損切り（TP/SL）設定
- トレーディングセッションタイムを設定可能
- リスク％に合わせたロットサイズ自動計算
- パラメータで柔軟にカスタマイズ可能
- 時間設定は日本時間。サーバー時間へサマータイムも含め自動換算

---

## パラメータ説明
![スクリーンショット 2025-06-01 160023](https://github.com/user-attachments/assets/5a822654-a700-4af7-9e4e-522ecff7930e)

## パラメータ説明

| パラメータ名             | 内容・用途                                                      | 初期値        |
|--------------------------|---------------------------------------------------------------|---------------|
| START_HOUR               | エントリー受付開始時刻（時）                                   | 15            |
| START_MINUTE             | エントリー受付開始時刻（分）                                   | 30            |
| END_HOUR                 | エントリー受付終了時刻（時）                                   | 0             |
| END_MINUTE               | エントリー受付終了時刻（分）                                   | 30            |
| cancelPendingHour        | 指値・逆指値注文を自動キャンセルするまでの経過時間（時）       | 0             |
| cancelPendingMin         | 指値・逆指値注文を自動キャンセルするまでの経過時間（分）       | 30            |
| 許容損失（%）            | 1トレードあたり許容する最大損失率（口座残高に対するパーセント） | 1.0           |
| SL                       | ストップロス（損切り幅, pips）                                 | 15.0          |
| TP                       | テイクプロフィット（利確幅, pips）                             | 30.0          |
| MagicNumber              | EA識別用のマジックナンバー                                     | 12345         |
| MaxSpread                | 許容する最大スプレッド（pips）                                  | 3.0           |
| チャートオブジェクト描写 | チャート上にオブジェクトを描画するか（true/false）   　　　　　　　| false         |
| 描画する目数             | 描画するレンジの本数                                           | 5             |
| 線の色                   | チャートに描画するラインの色                                   | Red           |
| 線のスタイル             | チャートに描画するラインのスタイル（例: Dash=破線, Solid=実線）| Dash          |
| 線の幅                   | チャートに描画するラインの太さ                                 | 1             |

---

### パラメータ補足

- **START_HOUR / START_MINUTE / END_HOUR / END_MINUTE**  
  エントリーを受け付ける時間帯を設定します（サーバー時間基準）。  
  ※時間設定は日本時間。サーバー時間へサマータイムも含め自動換算します
- **cancelPendingHour / cancelPendingMin**  
  新規指値・逆指値注文が未約定の場合、自動で注文をキャンセルするまでの時間を指定します。
- **許容損失（%）**  
  1回のトレードで許容する最大損失率（例：1.0なら口座残高の1％）。
- **SL / TP**  
  それぞれ損切り幅・利確幅（pips単位）。
- **MagicNumber**  
  EAによる注文識別用番号。他EAと重複しない値を推奨。
- **MaxSpread**  
  許容する最大スプレッド。これを超える場合は新規エントリーを行いません。
- **チャートオブジェクト描写 / 描画する目数 / 線の色 / 線のスタイル / 線の幅**  
  チャートにレンジライン等を描画する場合の各種設定。


---

## 使い方

1. `4-5J.ex5`ファイルをMetaTrader 5の`Experts`フォルダへコピー
4. チャートにEAをセット
5. パラメータを調整
6. まずは**デモ口座**で動作確認を推奨

---

## 推奨設定・注意事項

- 必ずデモ口座で十分テストしてから実運用してください
- パラメーター調整は商品ごとに最適化して自己判断にてパラメーターを選択してください
- 最適化やバックテストで高速処理を求める場合、オブジェクト描写をfalseにし、描画する目数を0にすることをお勧めします
- オブジェクト描写遅延に関して、ビジュアルバックテストでのパフォーマンス向上のため描写処理を軽量化している仕様のためです
- 使用は完全自己責任で

---

## バックテスト結果

### 2015年からの10年分バックテスト結果
![TesterGraphReport2025 04 14](https://github.com/user-attachments/assets/56dfdbd4-52d1-4326-b4fa-0653bfa877fd)

![ReportTester-52136179](https://github.com/user-attachments/assets/3040cf9c-26aa-4761-812e-af49e458ec57)

![ReportTester-52136179-holding](https://github.com/user-attachments/assets/45977e21-8b01-40b1-96e1-221162a8e1a5)

![ReportTester-52136179-hst](https://github.com/user-attachments/assets/f6a26d2d-79ef-41d5-86c5-3aae71b4f1bb)

![ReportTester-52136179-mfemae](https://github.com/user-attachments/assets/3b62686c-abd3-4951-8601-008c28aa4c71)
![スクリーンショット 2025-06-02 130738](https://github.com/user-attachments/assets/4830d135-6f5e-4037-8c5c-083ab3b9a83b)
![スクリーンショット 2025-06-02 130817](https://github.com/user-attachments/assets/85db7165-818b-43b3-96c6-4fc40d8e9ec3)

---
##　サンプル動画　（ビジュアルバックテスト）


https://github.com/user-attachments/assets/7fe61475-51fc-4072-ab68-4f2337ef39be


---

## ファイル構成

- `4-5J.mq5` : EA本体（ソースコード）
- `4-5J.ex5` : EA本体（コンパイル済みファイル）


---

